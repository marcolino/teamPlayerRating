"use strict";var app=angular.module("teamplayerratingApp",["ngRoute","ngSanitize","ui.bootstrap","firebase"]).constant("FIREBASE_URL","https://teamplayerrating.firebaseio.com").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/setup",{templateUrl:"views/setup.html",controller:"SetupCtrl"}).when("/matches",{templateUrl:"views/matchs.html",controller:"MatchsCtrl"}).when("/statistics",{templateUrl:"views/statistics.html",controller:"SetupCtrl"}).otherwise({redirectTo:"/"})}]);app.run(function(){}),function(a,b){"object"==typeof exports?module.exports=b():a.Spinner=b()}(this,function(){function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return l[e]||(m.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",m.cssRules.length),l[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<k.length;d++)if(c=k[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}m.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k=["webkit","Moz","ms","O"],l={},m=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),n={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};h.defaults={},f(h.prototype,{spin:function(b){this.stop();var c=this,d=c.opts,f=c.el=e(a(0,{className:d.className}),{position:d.position,width:0,zIndex:d.zIndex});if(e(f,{left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++)g=Math.max(1-(h+(d.lines-a)*n)%l*m,d.opacity),c.opacity(f,a*d.direction+i,g,d);c.timeout=c.el&&setTimeout(o,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var o=e(a("group"),{behavior:"url(#default#VML)"});return!d(o,"transform")&&o.adj?i():j=d(o,"animation"),h}),app.directive("validScore",function(){return{require:"?ngModel",link:function(a,b,c,d){d&&(d.$parsers.push(function(a){var b=a.replace(/[^0-9]+/g,"").replace(/^0([0-9])/,"$1");return a!==b&&(d.$setViewValue(b),d.$render()),b}),b.bind("keypress",function(a){32===a.keyCode&&a.preventDefault()}))}}}),app.directive("trapKey",function(){var a=13,b=27,c=null;return function(d,e,f){switch(f.key){case"enter":c=a;break;case"escape":c=b;break;default:c=a}e.bind("keydown keypress",function(a){a.which===c&&(d.$apply(function(){d.$eval(f.trapKey,{event:a})}),a.preventDefault())})}}),app.directive("reallyClick",["$modal",function(a){var b=function(a,b){a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}};return{restrict:"A",scope:{reallyClick:"&",item:"="},link:function(c,d,e){d.bind("click",function(){var d=e.reallyMessage||"Are you sure?",f='<div class="modal-body">'+d+"</div>";f+='<div class="modal-footer"><button class="btn btn-primary" ng-click="ok()">OK</button><button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>';var g=a.open({template:f,controller:b});g.result.then(function(){c.reallyClick({item:c.item})},function(){})})}}}]),app.directive("visualrating",function(){return{restrict:"E",template:'<span title="The bar length is the rating \'&sigma;\', which measures the player\'s skill; the bar height is the rating \'&mu;\', which measures the reliability of the skill (directly proportional to the number of matches played)">{{sigma | number:2}}</span> <span class="rating-bar" style="width:{{sigma / 4}}em; height:{{((25 / 3) - mu + 0.5) / 10}}em"></span>',link:function(a,b,c){c.$observe("ratin",function(b){console.info(JSON.parse(b));var c=JSON.parse(b);a.sigma=c.sigma,a.mu=c.mu})}}}),app.controller("NavCtrl",["$scope","$location",function(a,b){a.isCollapsed=!0,a.$on("$routeChangeSuccess",function(){a.isCollapsed=!0}),a.isActive=function(a){return a===b.path()}}]),app.controller("MainCtrl",["$scope","$location","$http","stateFactory","sportFactory","playerFactory","matchFactory","notificationFactory","sysFactory","spinnerFactory",function(a,b,c,d,e,f,g,h,i,j){var k=d;a.share=k,a.init=function(){k.initializedMain||(k.spinner||(k.spinner=j,k.spinner.show()),k.sports=e.all,k.players=f.all,f.ref.on("value",function(a){var b=a.val();k.playersAvailable=angular.copy(b),k.spinner.hide()}),a.getClientIP(),k.initializedMain=!0)},a.reset=function(){k.initMain(),k.initializedMain=!1},a.teamSelect=function(b){if(a.teamsCheckClosed())return!1;var c=b.target.id;if(c=c.replace(/^label-/,""))a.teamSetSelected(c),k.main.teamSelected=c.replace(/^team/,"");else{var d=b.target.firstChild.data;if(!d)return h.error("Selected element in team with empty first child data: ",b.target.firstChild,"!"),!1;var e=b.target.parentElement.id.replace(/^team/,""),f=!1;if(angular.forEach(k.main.match.teams[e].players,function(a,b){a.name===d&&(k.playersAvailable[b]=k.main.match.teams[e].players[b],delete k.main.match.teams[e].players[b],f=!0)}),!f)return h.error('Selected element name not found in team "'+e+'"!'),!1;k.main.teamsCompleted=a.teamsCheckCompleted()}return!0},a.isTeamSelected=function(a){return k.main.teamSelected===a},a.playerSelect=function(b){if(a.teamsCheckClosed())return!1;var c=b.currentTarget.firstElementChild.innerHTML;if(!c)return h.error("Empty name element target: ",b.target),!1;if(!k.main.teamSelected)return h.warning("Please select a team!"),!1;if(i.objectLength(k.main.match.teams[k.main.teamSelected].players)>=a.sportSelectedPlayersMax())return h.info("This team is complete"),!1;var d=f.findByProperty("name",c);return d?(k.main.match.teams[k.main.teamSelected].players[d]=k.playersAvailable[d],delete k.playersAvailable[d],k.main.teamsCompleted=a.teamsCheckCompleted(),k.main.teamsCompleted||0!==i.objectLength(k.playersAvailable)||h.warning("The number of players is insufficient to play a match. Please add some players!"),!0):(h.error('Selected player name "',c,'" not found!'),!1)},a.teamsCheckClosed=function(){return k.main.teamsClosed},a.teamsCheckCompleted=function(){return i.objectLength(k.main.match.teams.A.players)===a.sportSelectedPlayersMax()&&i.objectLength(k.main.match.teams.B.players)===a.sportSelectedPlayersMax()?(console.info("All teams are complete"),!0):!1},a.teamsClose=function(){a.teamsCheckCompleted()&&a.teamsSetClosed()},a.teamSetSelected=function(a){k.main.teamSelected=k.main.match.teams[a.replace(/^team/,"")],console.info("Selected team with id",a)},a.teamsSetClosed=function(){k.main.teamsClosed=!0,console.info("Teams closed")},a.matchCheckClosed=function(){return"undefined"!=typeof k.main.match.teams.A.score&&"undefined"!=typeof k.main.match.teams.B.score},a.matchCheckConfirmed=function(){return k.main.match.confirmed},a.matchConfirm=function(){return k.main.teamsClosed&&a.matchCheckClosed()?void a.updateSkills():!1},a.updateSkills=function(){var b;b=a.isIpPrivate(k.clientIP)?"localhost":"192.168.10.30";var d="http://"+b+"/teamPlayerRating/uty/PHPSkills/src/getNewSkills.php";console.info(k.main.match),c.jsonp(d+"?callback=JSON_CALLBACK&"+$.param(k.main.match)).success(function(b){console.info("new skill retrieved: ",b);for(var c in b){var d=b[c],e=k.players[d.id];e.skillPrevious||(e.skillPrevious=e.skill),e.skill.sigma=d.rating.sigma,e.skill.mu=d.rating.mu,f.set(d.id,e),console.info("player.skillPrevious:",e.skillPrevious),console.info("player.skill:",e.skill)}g.add(k.main.match).then(function(b){console.info("added match id:",b),k.main.match.confirmed=!0,a.go("/statistics")})}).error(function(a,b){console.error("new skills not retrieved!","Status is",b),h.error("Error calculating new ratings, match not saved!")})},a.getClientIP=function(){$.ajax({type:"GET",url:"http://api.hostip.info/get_json.php",dataType:"json",success:function(a){k.clientIP=a.ip},error:function(a,b,c){console.error("Error checking for current IP:","[request: "+a.statusText+"] [type: "+b+"] [status: "+c+"]")}})},a.isIpPrivate=function(a){var b=a.split(".");return"10"===b[0]||"172"===b[0]&&parseInt(b[1],10)>=16&&parseInt(b[1],10)<=31||"192"===b[0]&&168===b[1]?!0:!1},a.matchDateDisabled=function(){return!1},a.matchDateOpen=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.sportSelected=function(){return e.isSelected()},a.sportSelectedPlayersMax=function(){var b=a.sportSelected(),c=0;return angular.forEach(k.sports,function(a){a.name===b&&(c=parseInt(a.playersMax))}),c},a.go=function(a){b.path(a)},a.init()}]),app.controller("AboutCtrl",["$scope","stateFactory",function(a,b){var c=b;a.share=c}]),app.controller("SetupCtrl",["$scope","$filter","stateFactory","sportFactory","playerFactory","notificationFactory","sysFactory","spinnerFactory",function(a,b,c,d,e,f,g,h){var i=c;a.share=i,a.init=function(){i.setupInitialized?i.spinner.hide():(console.info(" * INITIALIZING"),i.spinner||(i.spinner=h,i.spinner.show()),i.sports=d.all,i.players=e.all,i.players.$on("loaded",function(){i.spinner.hide(),a.playersList=b("orderByPriority")(i.players),console.info("$scope.playersList:",a.playersList),a.playersSetRank()}),i.sports.$on("loaded",function(){i.spinner.hide()}),i.playersAddMode=!1,i.playersEditMode=!1,i.playersOrderByPredicate="name",i.sportsAddMode=!1,i.sportsEditMode=!1,i.sportsOrderByPredicate="name",i.skillDefault={sigma:25,mu:25/3},i.playerDefault={name:"",email:"",skill:i.skillDefault},i.playerAdd=angular.copy(i.playerDefault),i.playerEdit={},i.sportDefault={name:"",playersMax:0},i.sportAdd=angular.copy(i.sportDefault),i.sportEdit={},i.setupTabActive||(i.setupTabActive="tab-players"),i.setupInitialized=!0)},a.isSetupTabActive=function(a){return a===i.setupTabActive},a.playersPopulate=function(){i.playersDefault=[{name:"Frinks",email:"",skill:{sigma:25,mu:25/3}},{name:"Lucio",email:"",skill:{sigma:25,mu:25/3}},{name:"Soletta",email:"",skill:{sigma:25,mu:25/3}},{name:"Paoloalgo",email:"",skill:{sigma:25,mu:25/3}},{name:"Marcotono",email:"",skill:{sigma:25,mu:25/3}},{name:"Attila",email:"",skill:{sigma:25,mu:25/3}},{name:"Puntone",email:"",skill:{sigma:25,mu:25/3}},{name:"Bonnie",email:"",skill:{sigma:25,mu:25/3}},{name:"Remi",email:"",skill:{sigma:25,mu:25/3}},{name:"Grigio",email:"",skill:{sigma:25,mu:25/3}},{name:"Mosso",email:"",skill:{sigma:25,mu:25/3}},{name:"Nordin",email:"",skill:{sigma:25,mu:25/3}},{name:"Hermes",email:"",skill:{sigma:25,mu:25/3}},{name:"Cavallero",email:"",skill:{sigma:25,mu:25/3}},{name:"Alejandro",email:"",skill:{sigma:25,mu:25/3}},{name:"Francesco",email:"",skill:{sigma:25,mu:25/3}},{name:"Robertoventolin",email:"",skill:{sigma:25,mu:25/3}},{name:"Marcobellancio",email:"",skill:{sigma:25,mu:25/3}},{name:"Davide",email:"",skill:{sigma:25,mu:25/3}},{name:"Paffutello",email:"",skill:{sigma:25,mu:25/3}},{name:"Maxdamuri",email:"",skill:{sigma:25,mu:25/3}}],i.playersDefault.forEach(function(b){a.playerAdd(b)})},a.sportsPopulate=function(){i.sportsDefault=[{name:"Calcio a 5",playersMax:5,selected:!0},{name:"Calcio a 7",playersMax:7},{name:"Calcio a 8",playersMax:8},{name:"Calcio",playersMax:11},{name:"Rugby",playersMax:15}],i.sportsDefault.forEach(function(b){a.sportAdd(b)})},a.playersAreEmpty=function(){return 0===g.objectLength(i.players)},a.sportsAreEmpty=function(){return 0===g.objectLength(i.sports)},a.playersToggleAddMode=function(){i.playersAddMode=!i.playersAddMode},a.sportsToggleAddMode=function(){i.sportsAddMode=!i.sportsAddMode},a.playersToggleEditMode=function(a,b){console.log("id: ",a),console.log("player: ",b),console.log("share.players: ",i.players),a=b.$id,i.players[a].editMode=!i.players[a].editMode,i.players[a].editMode&&(i.playerEdit=angular.copy(b))},a.sportsToggleEditMode=function(a,b){i.sports[a].editMode=!i.sports[a].editMode,i.sports[a].editMode&&(i.sportEdit=angular.copy(b))},a.playerAdd=function(a){return e.findByProperty("name",a.name)?(f.error("Player name",a.name,"already present!"),!1):a.name?(e.add(a).then(function(a){console.info("added player id:",a)}),i.playerAdd=angular.copy(i.playerDefault),!0):(f.error("Player name can't be empty!"),!1)},a.sportAdd=function(a){return d.findByProperty("name",a.name)?(f.error("Sport name",a.name,"already present!"),!1):a.name?(d.add(a).then(function(a){console.info("added sport id:",a),f.success("ADDED sport id",a)}),i.sportAdd=angular.copy(i.sportDefault),!0):(f.error("Sport name can't be empty!"),!1)},a.playerUpdate=function(a,b){return b&&!b.name?(f.warning("Name can't be empty. To remove a player please use trash button."),!1):(i.players[a].editMode=!i.players[a].editMode,b.editMode=!b.editMode,e.set(a,b),i.players[a].editMode&&(i.playerEdit=angular.copy(b)),!0)},a.sportUpdate=function(a,b){return b&&!b.name?(f.waring("Name can't be empty. To remove a sport please use trash button."),!1):(i.sports[a].editMode=!i.sports[a].editMode,b.editMode=!b.editMode,d.set(a,b),i.sports[a].editMode&&(i.sportsEdit=angular.copy(b)),!0)},a.sportSelect=function(a){d.select(a)},a.sportSelected=function(){return d.isSelected()},a.playerRemove=function(a){e.remove(a)},a.sportRemove=function(a){d.remove(a)},a.playersRemoveAll=function(){e.remove()},a.sportsRemoveAll=function(){d.remove()},a.playerResetSkill=function(a,b){b.skill.sigma=25,b.skill.mu=25/3},a.playersResetSkillAll=function(){for(var b in i.players){var c=i.players[b];c.skill&&(a.playerResetSkill(null,c),e.set(b,c))}},a.playersSetRank=function(){console.info("playersSetRank()");var a,c=i.skillDefault,d=1,e=d,f=b("orderByPriority")(i.players);console.info("players before sort:",f),f.sort(function(a,b){return a.skill.sigma>b.skill.sigma||a.skill.sigma===b.skill.sigma&&a.skill.mu>=b.skill.mu?-1:1}),console.info("players after sort:",f);for(var g in f){var h=f[g];console.info('Player "'+h.name+'" id is ',h.$id),h.skill.sigma>c.sigma||h.skill.sigma===c.sigma&&h.skill.mu>=c.mu?(console.log(1,c),a=e):(console.log(2),a=d,e=d),i.players[h.$id].rank=a,d++}},a.init()}]),app.controller("MatchsCtrl",["$scope","$location","stateFactory","sportFactory","playerFactory","matchFactory","notificationFactory","sysFactory","spinnerFactory",function(a,b,c,d,e,f,g,h,i){var j=c;a.share=j,a.init=function(){j.matchsInitialized?j.spinner.hide():(console.info(" * INITIALIZING"),j.spinner||(j.spinner=i,j.spinner.show()),j.sports=d.all,j.players=e.all,j.matchs=f.all,j.matchs.$on("loaded",function(){j.spinner.hide(),console.info(j.matchs)}),j.matchsInitialized=!0)},a.matchUpdate=function(a,b){return b&&!b.name?(g.warning("Name can't be empty. To remove a match please use trash button."),!1):(j.matchs[a].editMode=!j.matchs[a].editMode,b.editMode=!b.editMode,f.set(a,b),j.matchs[a].editMode&&(j.matchEdit=angular.copy(b)),!0)},a.matchRemove=function(a){f.remove(a)},a.matchsRemoveAll=function(){f.remove()},a.goto=function(a){b.path(a)},a.toggleCollapse=function(){j.matchsCollapsed=!j.matchsCollapsed,console.info("share.matchsCollapsed:",j.matchsCollapsed)},a.init()}]),app.factory("stateFactory",function(){var a={};return a.initMain=function(){a.main={},a.main.title="Team player rating system",a.main.author={},a.main.author.name="Marco Solari",a.main.author.email="marcosolari@gmail.com",a.main.description="... TrueSkill<sup>&reg;</sup> ...",a.main.dateFormat="yyyy-MM-dd",a.main.dateOptions={},a.main.dateOptions.startingDay=1,a.main.dateOptions.showWeeks=0,a.main.teamSelected=null,a.main.teamsCompleted=!1,a.main.teamsClosed=!1,a.main.match={},a.main.match.date=new Date,a.main.match.confirmed=!1,a.main.match.teams={},a.main.match.teams.A={name:"Oranges",score:null,players:{}},a.main.match.teams.B={name:"Blues",score:null,players:{}}},a.initMatchs=function(){a.matchsEditMode=!1,a.matchsCollapsed=!0,a.matchsOrderByPredicate="date"},a.initMain(),a.initMatchs(),a}),app.factory("sportFactory",["$firebase","FIREBASE_URL",function(a,b){var c=b+"/sports",d=new Firebase(c),e=a(d);return{ref:d,all:e,add:function(a){return e.$add(a).then(function(a){var b=a.name();return b},function(a){return console.error("ERROR:",a),null})},set:function(a,b){d.child(a).set(b)},find:function(a){return e.$child(a)},findByProperty:function(a,b){var c=null;return d.once("value",function(d){d.forEach(function(d){var e=d.name();d.ref().child(a).once("value",function(a){a.val()===b&&(c=e)})})}),c},remove:function(a){return e.$remove(a)},select:function(a){d.once("value",function(b){b.forEach(function(b){b.ref().child("name").once("value",function(c){b.ref().child("selected").set(c.val()===e.$child(a).name?!0:!1)})})})},isSelected:function(){var a=e;for(var b in a)if(a.hasOwnProperty(b)&&"object"==typeof a[b]&&null!==a[b]&&a[b].selected)return a[b].name;return null}}}]),app.factory("playerFactory",["$firebase","FIREBASE_URL",function(a,b){var c=b+"/players",d=new Firebase(c),e=a(d),f={ref:d,all:e};return f.add=function(a){return f.findByProperty("name",a.name)?(console.error("ERROR: duplicate player name",a.name),null):e.$add(a).then(function(a){var b=a.name();return b},function(a){return console.error("ERROR:",a),null})},f.set=function(a,b){d.child(a).set(b)},f.find=function(a){return e.$child(a)},f.findByProperty=function(a,b){var c=null;return d.once("value",function(d){d.forEach(function(d){var e=d.name();d.ref().child(a).once("value",function(a){a.val()===b&&(c=e)})})}),c},f.remove=function(a){return e.$remove(a)},f.setRating=function(a,b){console.info("id:",a),console.info("ref.child(id):",d.child(a)),d.child(a).skill.set(b)},f}]),app.factory("matchFactory",["$firebase","FIREBASE_URL",function(a,b){var c=b+"/matchs",d=new Firebase(c),e=a(d);return{ref:d,all:e,add:function(a){return e.$add(a).then(function(a){var b=a.name();return b},function(a){return console.error("ERROR:",a),null})},set:function(a,b){d.child(a).set(b)},find:function(a){return e.$child(a)},findByProperty:function(a,b){var c=null;return d.once("value",function(d){d.forEach(function(d){var e=d.name();d.ref().child(a).once("value",function(a){a.val()===b&&(c=e)})})}),c},remove:function(a){return e.$remove(a)}}}]),app.factory("notificationFactory",["$timeout",function(a){function b(a){d[a]=""}function c(){for(var a="",b=0;b<arguments.length;b++)a+=(b>0?" ":"")+JSON.stringify(arguments[b]);return a.replace(/^"/g,"").replace(/"$/g,"").replace(/\\/g,"")}toastr.options={closeButton:!1,debug:!1,positionClass:"toast-top-right",onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"3500",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};var d=[];return{success:function(){var e=c.apply(this,arguments);d.success!==e&&(toastr.success(e),a(function(){b("success")},toastr.options.timeOut,!1),d.success=e)},info:function(){var e=c.apply(this,arguments);d.info!==e&&(toastr.info(e),a(function(){b("info")},toastr.options.timeOut,!1),d.info=e)},warning:function(){var e=c.apply(this,arguments);d.warning!==e&&(toastr.warning(e),a(function(){b("warning")},toastr.options.timeOut,!1),d.warning=e)},error:function(){var e=c.apply(this,arguments);d.error!==e&&(toastr.error(e),a(function(){b("error")},toastr.options.timeOut,!1),d.error=e)}}}]),app.factory("spinnerFactory",function(){var a={lines:13,length:14,width:13,radius:31,corners:1,rotate:0,direction:1,color:"#aaa",speed:1.1,trail:61,shadow:!0,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"},b=new Spinner(a).spin();return{show:function(){document.getElementsByClassName("j-spinner")[0].appendChild(b.el)},hide:function(){b.stop()}}}),app.factory("sysFactory",function(){return{objectLength:function(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&"object"==typeof a[c]&&null!==a[c]&&++b;return b},objectDelete:function(a,b){for(var c in a)a.hasOwnProperty(c)&&("object"==typeof a[c]?(this.objectDelete(a[c],b+"."+c),delete a[c]):(console.log(c,":",a[c]),delete a[c]))}}});